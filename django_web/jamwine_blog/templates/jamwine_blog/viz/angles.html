{% comment %} <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script> {% endcomment %}
    
<style>
  html,
  body {
    margin: 0;
    padding: 0;
    background-color: #000011;
  }

  #canvas {
    margin: 0 auto;
    display: block;
  }
</style>

<canvas id="canvas"></canvas>

<script>
  /**
   * Converts the given degrees into radii
   * @param degrees - A degree is a measurement of a plane angle in which one full rotation is 360 degrees
   */
  const degToRad = (degree) => {
    return degree * (Math.PI / 180);
  };

  /**
   * Returns a random integer between a given minimum and maximum value
   * @param min - The minimum value, can be negative
   * @param max - The maximum value, can be negative
   */
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  const settings = {
    numberOfSlices: 10,
    radius: 100,
  };

  /**
   * Application Class
   */
  class Application {
    /**
     * Application constructor
     */
    constructor() {
      this.canvas = document.getElementById("canvas");
      this.context = this.canvas.getContext("2d");
      this.width = this.canvas.width = window.innerWidth;
      this.height = this.canvas.height = window.innerHeight;
      this.center = {
        x: this.width / 2,
        y: this.height / 2,
      };

      this.slices = [];

      //Resize listener for the canvas to fill browser window dynamically
      window.addEventListener("resize", () => this.resizeCanvas(), false);
    }

    /**
     * Simple resize function. Reinitializing everything on the canvas while changing the width/height
     */
    resizeCanvas() {
      this.width = this.canvas.width = window.innerWidth;
      this.height = this.canvas.height = window.innerHeight;
      this.center = {
        x: this.width / 2,
        y: this.height / 2,
      };

      //Empty the previous container and fill it again with new Ghost objects
      this.slices = [];
      this.initializeSlices();
    }

    /**
     * Create a number of Slices objects based on the settings
     * @return void
     */
    initializeSlices() {
      const sliceSize = degToRad(360 / settings.numberOfSlices);

      for (let i = 0; i < settings.numberOfSlices; i++) {
        const angle = sliceSize * i;
        const x = this.center.x;
        const y = this.center.y;

        //Initialize a new instance of the Slice class
        const slice = new Slice(x, y, angle);

        //Add the Slice object to our array of Slice objects
        this.slices.push(slice);
      }
    }

    update() {
      for (let i = 0; i < this.slices.length; i++) {
        this.slices[i].update();
      }
    }

    /**
     * Renders the application and every child of the application
     * @return void
     */
    render() {
      //Clear the entire canvas every render
      this.context.clearRect(0, 0, this.width, this.height);

      //Trigger the render function on every child element
      for (let i = 0; i < this.slices.length; i++) {
        this.slices[i].render(this.context);
      }
    }

    /**
     * Update and render the application at least 60 times a second
     * @return void
     */
    loop() {
      this.update();
      this.render();

      window.requestAnimationFrame(() => this.loop());
    }
  }

  class Slice {
    constructor(x, y, angle, size) {
      this.x = x;
      this.y = y;
      this.angle = angle;
      this.size = getRandomInt(0.2, 3);
      this.speed = getRandomInt(-10, 50) / 3000;

      this.rectWidth = getRandomInt(5, 15);
      this.rectHeight = getRandomInt(20, 200);
      this.rectOffset = getRandomInt(0, 100);

      this.arcWidth = getRandomInt(2, 20);
      this.arcOffset = getRandomInt(0, 200);
      this.arcStartAngle = getRandomInt(angle, angle + 50);
      this.arcEndAngle = getRandomInt(angle - 50, angle);
    }

    render(context) {
      const x = this.x + settings.radius * Math.sin(this.angle);
      const y = this.y + settings.radius * Math.cos(this.angle);

      // Draw rectangle
      context.save();
      context.translate(x, y);
      context.rotate(-this.angle);
      context.scale(this.size, 1);

      context.beginPath();
      context.fillStyle = "white";
      context.rect(-5, this.rectOffset, this.rectWidth, this.rectHeight);
      context.fill();

      context.restore();

      // Draw arc
      context.save();
      context.translate(this.x, this.y);

      context.beginPath();
      context.strokeStyle = "white";
      context.lineWidth = this.arcWidth;
      context.arc(
        0,
        0,
        settings.radius + this.arcOffset,
        this.angle + this.arcStartAngle,
        this.angle + this.arcEndAngle
      );
      context.stroke();

      context.restore();
    }

    update() {
      this.angle += this.speed;
    }
  }

  /**
   * Onload function is executed whenever the page is done loading, initializes the application
   * @return {void}
   */
  window.onload = function () {
    //Create a new instance of the application
    const application = new Application();

    //Initialize all slices for the first time
    application.initializeSlices();

    //Initialize the dat.GUI object and assign the variables that the user can adjust
    //const gui = new dat.GUI();
    //gui.add(settings, "numberOfSlices", 2, 20, 1).onChange(() => {
    //  application.resizeCanvas();
    //});
   // gui.add(settings, "radius", 0, 200);

    //Start the initial loop function for the first time
    application.loop();
  };
</script>
